<div class="flex flex-col items-center w-full h-full justify-between gap-2">
      
  <div class="w-full bg-white rounded-2xl shadow-sm p-2 flex flex-col items-center border-b-4 border-slate-100 relative overflow-hidden flex-1 min-h-0 justify-center">
    
    <div class="absolute top-2 right-2 flex items-center gap-1 text-xs font-mono font-bold bg-slate-100 text-slate-600 px-2 py-1 rounded-lg">
        <span>üïí {{ formatTime(sessionElapsedTime()) }}</span>
        <span class="text-slate-300 mx-1">|</span>
        <span [class]="isTimeWarning() ? 'text-red-600 animate-pulse' : ''" class="flex items-center gap-1">
            ‚è± {{ timerSeconds() }}s
        </span>
    </div>

    <h2 class="text-sm text-slate-400 font-bold uppercase tracking-wider mb-1">{{ modeTitle() }}</h2>
    
    <div class="text-4xl sm:text-5xl font-bold text-slate-800 mb-2 text-center leading-tight">
        {{ currentProblem()?.questionStr }}
    </div>
    
    <div class="w-full max-w-[80%] h-14 bg-slate-100 rounded-xl flex items-center justify-center text-3xl font-mono font-bold text-blue-600 border-2 border-slate-200 relative mb-1">
        {{ userAnswer() }}<span class="animate-pulse text-slate-300">|</span>
    </div>

    <div class="min-h-[3rem] px-2 flex items-center justify-center w-full">
      @if (feedbackMessage()) {
        <div [class]="feedbackType() === 'success' ? 'text-green-600 font-bold text-lg' : 'text-red-500 font-bold text-base text-center leading-tight'">
          {{ feedbackMessage() }}
        </div>
      } @else if (aiHint()) {
        <div class="text-purple-600 text-center text-xs bg-purple-50 p-1 rounded border border-purple-200 leading-tight line-clamp-2">
          ü§ñ {{ aiHint() }}
        </div>
      } @else if (isLoadingAi()) {
        <div class="text-purple-500 text-xs animate-pulse">{{ i18n.t('thinking') }}...</div>
      }
    </div>
  </div>

  <div class="w-full shrink-0 flex flex-col gap-2">
    
    <div class="grid grid-cols-3 gap-2">
      @for (num of keypadNumbers; track num) {
        <button (click)="numberAppended.emit(num)" 
          class="h-14 sm:h-16 bg-white rounded-xl shadow-sm text-2xl font-bold text-slate-700 active:bg-slate-100 border-b-4 border-slate-200 active:border-b-0 active:translate-y-1 transition-all">
          {{ num }}
        </button>
      }
      
      <button (click)="onHelpButtonClick()"
        [disabled]="isLoadingAi()"
        [class]="isSpeaking() ? 'bg-red-100 border-red-200 text-red-600' : 'bg-purple-50 border-purple-100 text-purple-600'"
        class="h-14 sm:h-16 rounded-xl shadow-sm font-bold text-sm flex flex-col items-center justify-center active:bg-purple-100 border-b-4 active:border-b-0 active:translate-y-1 transition-all disabled:opacity-50 disabled:cursor-wait">
        @if (isSpeaking()) {
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-7 h-7 animate-pulse">
            <path d="M13.5 4.06c0-1.336-1.616-2.005-2.56-1.06l-4.5 4.5H4.508c-1.141 0-2.318.664-2.66 1.905A9.76 9.76 0 001.5 12c0 .898.121 1.768.348 2.595.341 1.24 1.518 1.905 2.66 1.905H6.44l4.5 4.5c.944.945 2.56.276 2.56-1.06V4.06zM18.584 5.106a.75.75 0 011.06 0c3.808 3.807 3.808 9.98 0 13.788a.75.75 0 01-1.06-1.06 8.25 8.25 0 000-11.668.75.75 0 010-1.06z" />
            <path d="M15.932 7.757a.75.75 0 011.061 0 6 6 0 010 8.486.75.75 0 01-1.06-1.061 4.5 4.5 0 000-6.364.75.75 0 010-1.06z" />
          </svg>
          <span class="text-xs">{{ i18n.t('stopSpeaking') }}</span>
        } @else {
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-7 h-7">
            <path d="M12 2.25a.75.75 0 01.75.75v.512c1.033.22 2.013.626 2.924 1.199a.75.75 0 01-.84 1.206 7.5 7.5 0 00-9.668 0 .75.75 0 01-.84-1.206A9.004 9.004 0 0111.25 3.512v-.512a.75.75 0 01.75-.75z" />
            <path fill-rule="evenodd" d="M12 4.5a.75.75 0 01.69.455 8.25 8.25 0 013.844 12.011.75.75 0 01-1.052.288A6.75 6.75 0 007.5 16.5a.75.75 0 010 1.5h9a.75.75 0 010-1.5 6.75 6.75 0 00-6.255-6.237.75.75 0 01.288-1.052A8.25 8.25 0 0111.31 4.955.75.75 0 0112 4.5zm1.512 8.255a.75.75 0 01-.225 1.036l-2.25 1.5a.75.75 0 01-1.074-.82l.823-2.69-2.015-1.42a.75.75 0 01.5-1.328l2.743.213 1.22-2.522a.75.75 0 011.342.65L14.4 12.1l2.583.568a.75.75 0 01-.225 1.036l-2.25 1.5z" clip-rule="evenodd" />
          </svg>
          <span class="text-xs">{{ i18n.t('aiTeacher') }}</span>
        }
      </button>
      
      <button (click)="numberAppended.emit(0)" 
        class="h-14 sm:h-16 bg-white rounded-xl shadow-sm text-2xl font-bold text-slate-700 active:bg-slate-100 border-b-4 border-slate-200 active:border-b-0 active:translate-y-1 transition-all">
        0
      </button>
      
      <button (click)="backspaceClicked.emit()" 
        class="h-14 sm:h-16 bg-red-50 rounded-xl shadow-sm text-red-500 font-bold active:bg-red-100 border-b-4 border-red-100 active:border-b-0 active:translate-y-1 flex items-center justify-center transition-all">
        ‚å´
      </button>
    </div>

    <button (click)="answerChecked.emit()" 
      [disabled]="userAnswer().length === 0"
      [class]="userAnswer().length > 0 ? 'bg-indigo-600 hover:bg-indigo-700 text-white shadow-lg border-b-4 border-indigo-800 active:border-b-0 active:translate-y-1' : 'bg-slate-300 text-white cursor-not-allowed border-b-4 border-slate-400'"
      class="w-full h-14 sm:h-16 rounded-2xl text-2xl font-bold transition-all duration-100 flex items-center justify-center gap-2">
      {{ i18n.t('submitAnswer') }}
    </button>
  </div>
</div>